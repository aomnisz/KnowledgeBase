# Login write-up 及搜集一些奇怪的 MD5

题目提示 “需要密码才能获得flag哦” ，直接访问链接 http://web.jarvisoj.com:32772/ 就是一个简单的输入框。简单试了一下 sql 注入，不行。再找了找有没有给提示，robots.txt 或者源码泄露之类的，也没有。~~就放弃了。~~下次不能这么快放弃！

看了别人的题解，是在 HTTP 响应头里给了提示：

```
Hint: "select * from `admin` where password='".md5($pass,true)."'"
```

这个 md5 是 PHP 的函数。（别搞错了，我一开始复现的时候还以为是 MySQL 的函数。。。）

第一个参数是我们通过输入框传进来的密码，第二个参数是要不要将 MD5 报文摘要以16字节长度的原始二进制格式返回。看起来有点难懂，实际上就是要不要把16进制的 md5 结果转换成字符串，如 0x44 => "D" 。第二个参数默认是 false ，但这个题目里是 true ，也就是说 md5 结果会转换成字符串，这就意味着我们有机可乘了。

知道这个之后，接下来就是常规的注入。首先想好注入的语句是 `<trash>'or'<trash>` ，然后将中间有用部分的 `'or'` 转换成16进制，即为 `276f7227` 。最后就是爆破了，爆破出 md5 结果包含这个16进制的字符串，就是题解。

这里我就拿来主义了，这个答案也是很多 write-up 给出的答案： `ffifdyop` ，它对应的 md5 结果是 **276f7227**36c95d99e921722cf9ed621c 。

输入进去，完成注入，得到 flag 。

题目是到这里就完了，但我总想着，做一道题不能仅限于这道题，要扩展到其他的题目去。（把一道题掰成三道题来用，企图走捷径，快速成长。）我记得 PHP 的 md5 函数是漏洞很多的了，不如就借这个机会来总结一下。

### 1. "0e" 是 0

在 PHP 中，检查两个值是否相等有两种方式，一个是 `==` ，另一个是 `===` 。前者是忽略类型检查，会进行类型转换；而后者除了比对值以外还要比对类型，且不会进行类型转换。

对于会自动转换类型的 `==` 比较，（我觉得） PHP 引擎会尽可能的促成这个判断是 true 。因此给定两个 "0e" 开头的字符串，PHP引擎会将 "e" 解释成科学计数法的标志，让等式两边的值都变成 0 ，从而使得这个判断为 true 。这就让两个不同值的变量的 hash 相等 `hash(foo) == hash(bar)` 成为可能。

列举几个 "0e" 例子（出自[CTF中常见php-MD5()函数漏洞](https://www.loongten.com/2020/02/22/ctf-php-md5/)）：

- md5 数字型：`3465814713`, `3908336290`, `3293867441`, `314282422`
- md5 字母型：`EEIZDOI`, `GGHMVOE`, `MMHUWUV`, `NOOPCJF`
- sha1 数字型：`aaroZmOk`, `aaK1STfY`, `aaO8zKZF`, `aa3OFF9m`

### 2. [] 的 hash 是 NULL

在第一点中说了会自动转换类型的 `==` 比较怎么破，那接下来的这一点就说说不会自动转换类型的 `===` 比较怎么破。想让两个不同字符串的 hash 相同是几乎不可能的，但是有一个取巧的办法，那就是 PHP 在计算数组的 hash 时会报警告，并返回 NULL 。所以只要利用相同返回值 NULL 这个特点，就可以使得 `hash(foo) == hash(bar)` 。

```php
$foo[] = 0;
$bar[] = 1;
md5($foo) === md5($bar)  // true
```

### 3. hash 碰撞

如果说，前面两点是取巧的话，那么这一点就是实打实的拼实力碰撞了。md5 的碰撞很多了，甚至还有一个专门的工具来干这个 [fastcoll](https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip) 。如果是 sha1 ，则有 [sha1collider](https://github.com/nneonneo/sha1collider) ，不过 sha1 仅限于 PDF 文件。md5 的也给些例子吧：

出自[山东大学论文的碰撞例子](https://www.mscs.dal.ca/~selinger/md5collision/)，md5 的结果是 79054025255fb1a26e4bc422aef54eb4

```
Param1=%d1%31%dd%02%c5%e6%ee%c4%69%3d%9a%06%98%af%f9%5c%2f%ca%b5%87%12%46%7e%ab%40%04%58%3e%b8%fb%7f%89%55%ad%34%06%09%f4%b3%02%83%e4%88%83%25%71%41%5a%08%51%25%e8%f7%cd%c9%9f%d9%1d%bd%f2%80%37%3c%5b%d8%82%3e%31%56%34%8f%5b%ae%6d%ac%d4%36%c9%19%c6%dd%53%e2%b4%87%da%03%fd%02%39%63%06%d2%48%cd%a0%e9%9f%33%42%0f%57%7e%e8%ce%54%b6%70%80%a8%0d%1e%c6%98%21%bc%b6%a8%83%93%96%f9%65%2b%6f%f7%2a%70
Param2=%d1%31%dd%02%c5%e6%ee%c4%69%3d%9a%06%98%af%f9%5c%2f%ca%b5%07%12%46%7e%ab%40%04%58%3e%b8%fb%7f%89%55%ad%34%06%09%f4%b3%02%83%e4%88%83%25%f1%41%5a%08%51%25%e8%f7%cd%c9%9f%d9%1d%bd%72%80%37%3c%5b%d8%82%3e%31%56%34%8f%5b%ae%6d%ac%d4%36%c9%19%c6%dd%53%e2%34%87%da%03%fd%02%39%63%06%d2%48%cd%a0%e9%9f%33%42%0f%57%7e%e8%ce%54%b6%70%80%28%0d%1e%c6%98%21%bc%b6%a8%83%93%96%f9%65%ab%6f%f7%2a%70
```

出自[CTF中常见php-MD5()函数漏洞](https://www.loongten.com/2020/02/22/ctf-php-md5/)，md5 的结果是 008ee33a9d58b51cfeb425b0959121c9

```
Param1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
Param2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
```
